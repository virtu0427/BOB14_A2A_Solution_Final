<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ATS - 에이전트</title>
    <script>
      (function () {
        const token = localStorage.getItem("atsAuthToken");
        if (!token) {
          window.location.replace("/login");
        }
      })();
    </script>
    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" href="/agents/style.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap"
    />
    <script src="../auth.js" defer></script>
    <script src="/agents/agents.js" defer></script>
  </head>
  <body>
    <div class="app-container" data-page="agents">
      <header class="app-header">
        <a href="/dashboard" class="logo">
          <img src="/Attager.png" alt="ATS Logo" class="logo-img" />
          <div class="logo-text">
            <span class="logo-title">ATS</span>
            <span class="logo-subtitle">A2A Threat detection System</span>
          </div>
        </a>
        <nav class="main-nav">
          <a href="/dashboard" class="nav-link">대시보드</a>
          <a href="/agents" class="nav-link active">에이전트</a>
          <a href="/logs" class="nav-link">로그</a>
          <a href="/rulesets" class="nav-link">룰셋</a>
          <span class="nav-token-exp" data-token-exp aria-live="polite"></span>
          <a href="#" class="nav-link" data-logout>로그아웃</a>
        </nav>
      </header>

      <main class="content-area">
        <div class="content-wrapper">
          <section id="agents" class="content-page active">
            <div class="agents-layout">
              <!-- 사이드바: 에이전트 목록 + 네이버 스타일 검색바 -->
              <aside class="widget agent-sidebar">
                <div class="widget-header-with-button">
                  <div class="widget-title icon-title">
                    <span
                      class="material-symbols-outlined icon-robot"
                      aria-hidden="true"
                      >robot_2</span
                    >
                    <span class="sr-only">에이전트 목록</span>
                  </div>
                  <div class="widget-actions">
                    <label class="agent-search agent-search-bar">
                      <span class="material-symbols-outlined agent-search-icon" aria-hidden="true">search</span>
                      <input
                        type="search"
                        aria-label="에이전트 검색"
                        class="agent-search-input"
                        placeholder="에이전트 검색"
                        id="agent-search"
                        autocomplete="off"
                      />
                    </label>
                  </div>
                </div>

                <ul class="agent-list" id="agent-list">
                  <li class="empty-state">에이전트를 불러오는 중…</li>
                </ul>
              </aside>

              <!-- 에이전트 상세 -->
              <article class="widget agent-details" id="agent-details">
                <div class="agent-details-placeholder">
                  <h3>에이전트를 선택하세요</h3>
                  <p>
                    왼쪽 목록에서 에이전트를 선택하면 플러그인 연결 현황을
                    확인할 수 있습니다.
                  </p>
                </div>
              </article>
            </div>
          </section>
        </div>
      </main>
    </div>

    <!-- 에이전트 리스트 템플릿 -->
    <template id="agent-item-template">
      <li class="agent-item">
        <div class="agent-info">
          <span class="agent-name"></span>
          <span class="agent-description"></span>
        </div>
        <span class="status-chip"></span>
      </li>
    </template>

    <!-- 에이전트 상세 템플릿 -->
    <template id="agent-details-template">
      <div class="agent-overview">
        <div class="overview-header">
          <div>
            <h2 class="agent-title"></h2>
            <p class="agent-subtitle"></p>
          </div>
          <div class="overview-meta">
            <span class="status-chip"></span>
            <span class="pill" data-role="created"></span>
          </div>
        </div>

        <div class="overview-actions">
          <span class="status-message" id="agent-action-status" role="status"></span>
          <button type="button" class="btn-primary btn-small" id="refresh-policy-btn">
            <span class="material-symbols-outlined" aria-hidden="true">refresh</span>
            룰셋 새로고침
          </button>
          <button type="button" class="btn-danger btn-small" id="delete-agent-btn">
            <span class="material-symbols-outlined" aria-hidden="true">delete</span>
            삭제
          </button>
        </div>

        <!-- 에이전트 상세 정보 -->
        <div class="agent-info-panel">
          <h3>에이전트 정보</h3>
          <div class="agent-info-grid" id="agent-info-grid">
            <!-- JS에서 동적 생성 -->
          </div>
        </div>

        <!-- 에이전트 기능 (Tools) -->
        <div class="capabilities-panel">
          <h3>에이전트 기능</h3>
          <ul class="tools-list" id="tools-list">
            <!-- JS에서 동적 생성 -->
          </ul>
        </div>
      </div>
    </template>

    <!-- 에이전트 추가 모달 -->
    <div class="modal-overlay hidden" id="add-agent-modal">
      <div
        class="modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="add-agent-modal-title"
      >
        <div class="modal-header">
          <h3 id="add-agent-modal-title">에이전트 카드 추가</h3>
          <button
            class="btn-secondary"
            id="close-add-agent-modal"
            type="button"
          >
            닫기
          </button>
        </div>
        <div class="modal-content">
          <form id="add-agent-form" class="modal-form">
            <label for="add-agent-body"
              >JSON 형태의 카드 데이터를 입력하세요.</label
            >
            <textarea
              id="add-agent-body"
              placeholder='{"card": {"name": "...", ...}}'
              rows="8"
              required
            ></textarea>
            <fieldset class="checkbox-group">
              <legend>테넌트 선택</legend>
              <label><input type="checkbox" name="tenant" value="customer-service" /> customer-service</label>
              <label><input type="checkbox" name="tenant" value="logistics" /> logistics</label>
            </fieldset>
            <div class="form-actions">
              <span
                id="add-agent-status"
                class="status-message"
                role="status"
              ></span>
              <button type="submit" class="btn-primary">카드 등록</button>
            </div>
          </form>
        </div>
    </div>
  </div>

    <!-- FAB: 에이전트 추가 -->
    <div class="agent-add-fab">
      <button
        class="btn-primary add-icon-button"
        id="open-add-agent-btn"
        type="button"
      >
        <span class="material-symbols-outlined icon-add" aria-hidden="true"
          >add</span
        >
        <span class="sr-only">에이전트 카드 추가</span>
      </button>
    </div>

  </body>
</html>  
