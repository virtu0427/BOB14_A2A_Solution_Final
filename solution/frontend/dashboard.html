<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>A2A Observability Dashboard</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
    <script src="dashboard.js" defer></script>
  </head>
  <body>
    <div class="app-container" data-page="dashboard">
      <header class="app-header">
        <div class="logo">A2A SECURE</div>
        <nav class="main-nav">
          <a href="/dashboard" class="nav-link active">대시보드</a>
          <a href="/agents" class="nav-link">에이전트</a>
          <a href="/logs" class="nav-link">로그</a>
          <a href="/rulesets" class="nav-link">룰셋</a>
        </nav>
      </header>

      <main class="content-area">
        <div class="content-wrapper observability">
          <header class="dashboard-hero">
            <div>
              <p class="eyebrow">Tyk 스타일 · 정책/토큰/보안 가시성</p>
              <h1>A2A Observability Dashboard</h1>
              <p class="lede">
                API Gateway · JWT/JWS 서버 · IAM Policy Engine · Multi-Agents 전 구간의 트래픽/정책/토큰/보안 이벤트를 한눈에 모니터링합니다.
              </p>
            </div>
            <div class="hero-actions">
              <div class="filters">
                <label>
                  기간
                  <select id="time-range">
                    <option value="60">최근 60분</option>
                    <option value="360">최근 6시간</option>
                    <option value="1440">최근 24시간</option>
                  </select>
                </label>
                <label>
                  테넌트/고객사
                  <input id="tenant-filter" type="text" placeholder="tenant 또는 client id" />
                </label>
              </div>
              <div class="hero-buttons">
                <button class="btn-secondary" id="refresh-dashboard">새로고침</button>
              </div>
            </div>
          </header>

          <section class="kpi-grid">
            <article class="kpi-card" id="kpi-active-clients">
              <div class="kpi-title">Active A2A Clients</div>
              <div class="kpi-value" data-field="value">--</div>
              <div class="kpi-meta" data-field="meta">최근 15분 기준</div>
            </article>
            <article class="kpi-card" id="kpi-health">
              <div class="kpi-title">JWT/JWS Server Health</div>
              <div class="kpi-badges">
                <span class="pill" data-field="jwt">JWT: --</span>
                <span class="pill" data-field="jws">JWS: --</span>
              </div>
              <div class="kpi-meta" data-field="meta">지연/에러율 기반 상태</div>
            </article>
            <article class="kpi-card" id="kpi-throughput">
              <div class="kpi-title">Request Throughput</div>
              <div class="kpi-value" data-field="value">--</div>
              <div class="kpi-meta" data-field="trend">req/s · 최근 5분</div>
            </article>
            <article class="kpi-card" id="kpi-error-rate">
              <div class="kpi-title">Auth & Policy Error Rate</div>
              <div class="kpi-value" data-field="value">--</div>
              <div class="kpi-meta" data-field="meta">JWT/JWS 실패·Policy Block</div>
            </article>
          </section>

          <section class="panel-grid">
            <article class="widget dashboard-card span-6">
              <div class="widget-header-with-button">
                <div>
                  <h2 class="widget-title">정책 결과 분포</h2>
                  <p class="widget-subtitle">Allow / Deny / Quarantine / InvalidToken / RateLimit</p>
                </div>
              </div>
              <div class="card-body two-col">
                <div class="chart-shell compact">
                  <canvas id="policy-donut"></canvas>
                </div>
                <ul class="legend-list" id="policy-legend"></ul>
              </div>
            </article>

            <article class="widget dashboard-card span-6">
              <div class="widget-header-with-button">
                <div>
                  <h2 class="widget-title">요청 유형 분포</h2>
                  <p class="widget-subtitle">TokenIssue / TokenVerify / PolicyLookup / API Invoke</p>
                </div>
              </div>
              <div class="card-body two-col">
                <div class="chart-shell compact">
                  <canvas id="request-donut"></canvas>
                </div>
                <ul class="legend-list" id="request-legend"></ul>
              </div>
            </article>
          </section>

          <section class="panel-grid">
            <article class="widget dashboard-card span-6">
              <div class="widget-header-with-button">
                <div>
                  <h2 class="widget-title">룰셋 타입 분포</h2>
                  <p class="widget-subtitle">prompt_validation / tool_validation / response_filtering</p>
                </div>
              </div>
              <div class="card-body two-col">
                <div class="chart-shell compact">
                  <canvas id="ruleset-type-donut"></canvas>
                </div>
                <ul class="legend-list" id="ruleset-type-legend"></ul>
              </div>
            </article>

            <article class="widget dashboard-card span-6">
              <div class="widget-header-with-button">
                <div>
                  <h2 class="widget-title">룰셋 테넌트별 현황</h2>
                  <p class="widget-subtitle">테넌트/그룹 기준 룰셋 개수</p>
                </div>
              </div>
              <div class="card-body">
                <div class="chart-shell small">
                  <canvas id="ruleset-tenant-bar"></canvas>
                </div>
              </div>
            </article>
          </section>
        </div>
      </main>
    </div>
  </body>
</html>
